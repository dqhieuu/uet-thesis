\section{The method}
\label{sec:method}

\subsection{Requirements analysis}

To create a system that can an end-to-end solution



\subsection{System overview}

\subsubsection{Overall architecture}

Essentially, the system architecture serves the purpose of takes a single-view portrait image of a person and outputs a 3D avatar reconstructed from the input image. The overview of the system flow and the decision tree corresponding to the user's options are shown in the figure below.

\includefigure[The system flow overview, with options for reconstruction output.]{images/flow_newest_21.10.png}

The current state of the system allows the user to opt for applying the emotion not captured from the picture. This means the 3D avatar can show a wide range of emotional expressions without having to capture each portrait representing a different emotion.

The system additionally holds a database for hairstyles, which is very convenient for try-on purposes. Instead of going through the standard flow where the system extracts the user's hairstyle from the captured image, the user can try on a variety of hairstyles in the database to see if any of these hairstyles suit their face. The detailed of each reconstruction block will be explained in detail in the sections below.

\includefigure[The pipeline of the proposed system]{images/system_pipeline.png}

\begin{itemize}
    \item The system takes an image input with an API endpoint
    \item The image-to-head encoder outputs the FLAME's shape, pose, and expression parameters, and the extracted face texture.
    \item Optionally, the system can takes human-friendly emotion parameters to outputs FLAME's pose and expression parameters, using a simple emotion-to-FLAME regressive model.
    \item The FLAME-to-output decoder takes FLAME's shape, pose, and expression parameters, texture coordinate and extracted image texture to output a 3D model with a texture map and a normal map.
    \item While the head is being processed, the image-to-hair model outputs the reconstructed strand-based 3D hair model.
    \item Optinally, a 3D hair model can be chosen from the database instead of using the image-to-hair model for the try-on purpose.
    \item After the head model and the hair model are generated, they are combined with an alignment procedure to created an accurate 3D avatar zip file.
    \item Finally, the zip file is sent to the user, where the 3D renderer on user's web browser will be used to render the 3D avatar.
\end{itemize}


\subsection{3D face reconstruction}

\begin{plantuml}
    @startuml
    Alice -> Bob: Hello 2
    Alice <- Bob: Hi!
    @enduml
\end{plantuml}

\subsection{Customizable facial emotion}

\begin{plantuml}
    @startuml
    !theme spacelab
    a -> b
    b -> c
    @enduml
\end{plantuml}
